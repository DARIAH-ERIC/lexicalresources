<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><!--THIS FILE IS GENERATED FROM AN XML MASTER. DO NOT EDIT (5)--><title>Introduction to XSLT: scenarios and examples</title><meta name="author" content="Laurent Romary" /><meta name="generator" content="Text Encoding Initiative Consortium XSLT stylesheets" /><meta name="DC.Title" content="Introduction to XSLT: scenarios and examples" /><meta name="DC.Type" content="Text" /><meta name="DC.Format" content="text/html" /><link href="http://www.tei-c.org/release/xml/tei/stylesheet/tei.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" media="print" type="text/css" href="http://www.tei-c.org/release/xml/tei/stylesheet/tei-print.css" /></head><body class="simple" id="TOP"><div class="stdheader autogenerated"><h1 class="maintitle">Introduction to XSLT: scenarios and examples</h1></div><!--TEI front--><h2>Table of contents</h2><ul class="toc toc_body"><li class="toc"><span class="headingNumber">1. </span><a class="toc toc_0" href="#index.xml-body.1_div.1">General introduction to XSLT</a></li><li class="toc"><span class="headingNumber">2. </span><a class="toc toc_0" href="#index.xml-body.1_div.2">Making an XSLT stylesheet work</a><ul class="toc"><li class="toc"><span class="headingNumber">2.1. </span><a class="toc toc_1" href="#index.xml-body.1_div.2_div.1">Baseline XSLT structure</a></li><li class="toc"><span class="headingNumber">2.2. </span><a class="toc toc_1" href="#index.xml-body.1_div.2_div.2">Intercepting the default behaviour</a></li><li class="toc"><span class="headingNumber">2.3. </span><a class="toc toc_1" href="#index.xml-body.1_div.2_div.3">Intercepting the root element</a></li><li class="toc"><span class="headingNumber">2.4. </span><a class="toc toc_1" href="#index.xml-body.1_div.2_div.4">First notions of cherry picking</a></li></ul></li><li class="toc"><span class="headingNumber">3. </span><a class="toc toc_0" href="#index.xml-body.1_div.3">Sorting objects by means of xsl:sort</a></li><li class="toc"><span class="headingNumber">4. </span><a class="toc toc_0" href="#index.xml-body.1_div.4">Dictionary check-ups</a><ul class="toc"><li class="toc"><span class="headingNumber">4.1. </span><a class="toc toc_1" href="#index.xml-body.1_div.4_div.1">Entries without forms</a></li><li class="toc"><span class="headingNumber">4.2. </span><a class="toc toc_1" href="#index.xml-body.1_div.4_div.2">Definition not embedded in a sense</a></li><li class="toc"><span class="headingNumber">4.3. </span><a class="toc toc_1" href="#index.xml-body.1_div.4_div.3">Identifying duplicate entries</a></li><li class="toc"><span class="headingNumber">4.4. </span><a class="toc toc_1" href="#index.xml-body.1_div.4_div.4">Different words used in definitions</a></li></ul></li><li class="toc"><span class="headingNumber">5. </span><a class="toc toc_0" href="#index.xml-body.1_div.5">Complementary remarks</a></li></ul><!--TEI body--><div class="teidiv0" id="index.xml-body.1_div.1"><h2><span class="headingNumber">1. </span><span class="head">General introduction to XSLT</span></h2><ul><li class="item">An XML application; a recommendation of the W3C: <a class="link_ref" href="https://www.w3.org/TR/xslt/"><span class="titlem">XSL Transformations (XSLT)</span> Version 3.0 W3C Recommendation <span class="date">8 June 2017</span></a></li><li class="item">Based on XPath: addressing, selecting, functions</li><li class="item">Core principle: Input + XSLT =&gt; Output</li><li class="item">Usual usage: XML + XSLT =&gt; XML (e.g. XHTML)</li><li class="item">Other useful usages: <ul><li class="item">XML + XSLT =&gt; Text (e.g. generation of CSV outputs)</li><li class="item">Text + XSLT =&gt; XML (e.g. structuring of existing text input)</li></ul></li></ul></div><div class="teidiv0" id="index.xml-body.1_div.2"><h2><span class="headingNumber">2. </span><span class="head">Making an XSLT stylesheet work</span></h2><div class="teidiv1" id="index.xml-body.1_div.2_div.1"><h3><span class="headingNumber">2.1. </span><span class="head">Baseline XSLT structure</span></h3><p>The following example is a complete and workable stylesheet to generate an HTML output from an XML document.</p><div id="index.xml-egXML-d29e79" class="pre egXML_valid"><span class="element">&lt;xsl:stylesheet <span class="attribute">exclude-result-prefixes</span>="<span class="attributevalue">xs</span>"
 <span class="attribute">version</span>="<span class="attributevalue">2.0</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:output <span class="attribute">method</span>="<span class="attributevalue">html</span>" <span class="attribute">encoding</span>="<span class="attributevalue">UTF-8</span>"/&gt;</span>
<span class="element">&lt;/xsl:stylesheet&gt;</span></div><p>Linking an XSLT document to an existing XML document in Oxygen: <span class="q">‘Associate XSLT/CSS stylesheet’</span> (green pin).</p><p>Issues:</p><ul><li class="item">The XSLT namespace: <code>http://www.w3.org/1999/XSL/Transform</code></li><li class="item"><span class="gi">&lt;xsl:output&gt;</span>: importance of <span class="att">method</span> and <span class="att">encoding</span></li><li class="item">Default XSLT behaviour: traversal of the XML tree structure (from parent to child) until text nodes are encountered and send to the output stream</li><li class="item"><span class="gi">&lt;xsl:template&gt;</span>: intercepting the default behaviour</li></ul></div><div class="teidiv1" id="index.xml-body.1_div.2_div.2"><h3><span class="headingNumber">2.2. </span><span class="head">Intercepting the default behaviour</span></h3><p>The <span class="gi">&lt;xsl:template&gt;</span> element provides a specific behaviour for any node fulfilling the constraint in <span class="att">match</span></p><div id="index.xml-egXML-d29e119" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">entry</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;p&gt;</span>
  <span class="element">&lt;xsl:apply-templates/&gt;</span>
 <span class="element">&lt;/p&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div><p>Important: dealing with the namespace of the input document. Two possibilities:</p><ul><li class="item">declaring the namespace with a prefix and using the prefix for all TEI elements: <div id="index.xml-egXML-d29e128" class="pre egXML_valid"><span class="element">&lt;xsl:stylesheet <span class="attribute">version</span>="<span class="attributevalue">2.0</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:output <span class="attribute">method</span>="<span class="attributevalue">html</span>" <span class="attribute">encoding</span>="<span class="attributevalue">UTF-8</span>"/&gt;</span>
 <span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">tei:entry</span>"&gt;</span>
  <span class="element">&lt;p&gt;</span>
   <span class="element">&lt;xsl:apply-templates/&gt;</span>
  <span class="element">&lt;/p&gt;</span>
 <span class="element">&lt;/xsl:template&gt;</span>
<span class="element">&lt;/xsl:stylesheet&gt;</span></div></li><li class="item">declaring a default namespace for XPath constructs by means of <span class="att">xpath-default-namespace</span>: <div id="index.xml-egXML-d29e140" class="pre egXML_valid"><span class="element">&lt;xsl:stylesheet <span class="attribute">version</span>="<span class="attributevalue">2.0</span>"
 <span class="attribute">xpath-default-namespace</span>="<span class="attributevalue">http://www.tei-c.org/ns/1.0</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:output <span class="attribute">method</span>="<span class="attributevalue">html</span>" <span class="attribute">encoding</span>="<span class="attributevalue">UTF-8</span>"/&gt;</span>
 <span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">entry</span>"&gt;</span>
  <span class="element">&lt;p&gt;</span>
   <span class="element">&lt;xsl:apply-templates/&gt;</span>
  <span class="element">&lt;/p&gt;</span>
 <span class="element">&lt;/xsl:template&gt;</span>
<span class="element">&lt;/xsl:stylesheet&gt;</span></div></li></ul><p>We adopt the latter in the rest of the tutorial.</p><p>Playing with further presentational aspects:</p><ul><li class="item">Headwords in bold: <div id="index.xml-egXML-d29e154" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">orth</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;b&gt;</span>
  <span class="element">&lt;xsl:apply-templates/&gt;</span>
 <span class="element">&lt;/b&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div></li><li class="item">Examples in italics (Note: use of constraints in XPath): <div id="index.xml-egXML-d29e161" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">cit[@type='example']/quote</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;i&gt;</span>
  <span class="element">&lt;xsl:apply-templates/&gt;</span>
 <span class="element">&lt;/i&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div></li><li class="item">Putting parentheses around pronunciations: <div id="index.xml-egXML-d29e168" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">pron</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span>[<span class="element">&lt;/xsl:text&gt;</span>
 <span class="element">&lt;xsl:apply-templates/&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span>]<span class="element">&lt;/xsl:text&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div></li><li class="item">Variant: dealing with cases where the pronunciation is already in square brackets: <div id="index.xml-egXML-d29e178" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">pron[not(starts-with(normalize-space(.), '[') and ends-with(normalize-space(.), 
 ']'))]</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span>[<span class="element">&lt;/xsl:text&gt;</span>
 <span class="element">&lt;xsl:apply-templates/&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span>]<span class="element">&lt;/xsl:text&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div> <ul><li class="item">Logical operators: <code>and</code> and <code>not</code></li><li class="item">Removing leading and trailing whitespaces with <code>normalize-space()</code></li><li class="item">String functions in XSLT: <code>start-with()</code> and <code>ends-with()</code></li></ul></li></ul><p>Dealing with senses: presenting sense as a new line, numbering senses when they do not have a <span class="att">n</span> attribute.</p><div id="index.xml-egXML-d29e211" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">sense</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;br/&gt;</span>
 <span class="element">&lt;xsl:choose&gt;</span>
  <span class="element">&lt;xsl:when <span class="attribute">test</span>="<span class="attributevalue">@n</span>"&gt;</span>
   <span class="element">&lt;xsl:value-of <span class="attribute">select</span>="<span class="attributevalue">@n</span>"/&gt;</span>
  <span class="element">&lt;/xsl:when&gt;</span>
  <span class="element">&lt;xsl:otherwise&gt;</span>
   <span class="element">&lt;xsl:value-of <span class="attribute">select</span>="<span class="attributevalue">count(preceding-sibling::sense)+1</span>"/&gt;</span>
  <span class="element">&lt;/xsl:otherwise&gt;</span>
 <span class="element">&lt;/xsl:choose&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span>-<span class="element">&lt;/xsl:text&gt;</span>
 <span class="element">&lt;xsl:apply-templates/&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div><p>Main features:</p><ul><li class="item">Using axes: <code>preceding-sibling::*</code></li><li class="item">Arithmetic functions: <code>count()</code>, <code>+</code></li><li class="item">Multiple tests using <span class="gi">&lt;xsl:choose&gt;</span> (with <span class="gi">&lt;xsl:when&gt;</span> and <span class="gi">&lt;xsl:otherwise&gt;</span>)</li></ul></div><div class="teidiv1" id="index.xml-body.1_div.2_div.3"><h3><span class="headingNumber">2.3. </span><span class="head">Intercepting the root element</span></h3><p>Setting up the global structure of the output document and selecting the objects to visualise:</p><div id="index.xml-egXML-d29e253" class="pre egXML_valid"><span class="element">&lt;xsl:template <span class="attribute">match</span>="<span class="attributevalue">/</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;html&gt;</span>
  <span class="element">&lt;body&gt;</span>
   <span class="element">&lt;xsl:apply-templates/&gt;</span>
  <span class="element">&lt;/body&gt;</span>
 <span class="element">&lt;/html&gt;</span>
<span class="element">&lt;/xsl:template&gt;</span></div><div class="note" id="Note1"><span class="noteLabel">Note: </span>In real life: this is usually the first template to implement.</div></div><div class="teidiv1" id="index.xml-body.1_div.2_div.4"><h3><span class="headingNumber">2.4. </span><span class="head">First notions of cherry picking</span></h3><p>Showing the <span class="gi">&lt;body&gt;</span> only:</p><div id="index.xml-egXML-d29e268" class="pre egXML_valid"><span class="element">&lt;xsl:apply-templates <span class="attribute">select</span>="<span class="attributevalue">descendant::body</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"/&gt;</span></div><p>Building up a simple HTML head:</p><div id="index.xml-egXML-d29e272" class="pre egXML_valid"><span class="element">&lt;head
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;title&gt;</span>
  <span class="element">&lt;xsl:apply-templates <span class="attribute">select</span>="<span class="attributevalue">/TEI/teiHeader/fileDesc/titleStmt/title</span>"/&gt;</span>
 <span class="element">&lt;/title&gt;</span>
<span class="element">&lt;/head&gt;</span></div><div class="note" id="Note2"><span class="noteLabel">Note: </span>Using oXygen to get the appropriate XPath expression.</div></div></div><div class="teidiv0" id="index.xml-body.1_div.3"><h2><span class="headingNumber">3. </span><span class="head">Sorting objects by means of <span class="gi">&lt;xsl:sort&gt;</span></span></h2><p>Using <span class="gi">&lt;xsl:sort&gt;</span> requires two main elements:</p><ul><li class="item">A context that selects a group of nodes to be sorted (e.g. <span class="gi">&lt;xsl:apply-templates&gt;</span>)</li><li class="item">A sort key that can be extracted for each node of the group</li></ul><p>Sorting all orthographic forms as a header to the output document (e.g. to carry out a diagnosis).</p><div id="index.xml-egXML-d29e298" class="pre egXML_valid"><span class="element">&lt;xsl:for-each <span class="attribute">select</span>="<span class="attributevalue">descendant::entry</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
 <span class="element">&lt;xsl:sort <span class="attribute">select</span>="<span class="attributevalue">form[1]/orth[1]</span>"
  <span class="attribute">lang</span>="<span class="attributevalue">fr</span>"/&gt;</span>
 <span class="element">&lt;xsl:value-of <span class="attribute">select</span>="<span class="attributevalue">form[1]/orth[1]</span>"/&gt;</span>
 <span class="element">&lt;xsl:text&gt;</span> - <span class="element">&lt;/xsl:text&gt;</span>
<span class="element">&lt;/xsl:for-each&gt;</span></div></div><div class="teidiv0" id="index.xml-body.1_div.4"><h2><span class="headingNumber">4. </span><span class="head">Dictionary check-ups</span></h2><div class="teidiv1" id="index.xml-body.1_div.4_div.1"><h3><span class="headingNumber">4.1. </span><span class="head">Entries without forms</span></h3><div id="index.xml-egXML-d29e310" class="pre egXML_valid"><span class="element">&lt;xsl:apply-templates <span class="attribute">select</span>="<span class="attributevalue">descendant::entry[not(form)]</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"/&gt;</span></div><p>XPath and XSLT mechanisms in use:</p><ul><li class="item">Complex XML tree traversal with <span class="gi">&lt;xsl:apply-templates&gt;</span></li><li class="item">Testing the existence of a given child element (Does <span class="gi">&lt;entry&gt;</span> contain <span class="gi">&lt;form&gt;</span>?)</li><li class="item">XPtath function: <code>not()</code></li></ul></div><div class="teidiv1" id="index.xml-body.1_div.4_div.2"><h3><span class="headingNumber">4.2. </span><span class="head">Definition not embedded in a sense</span></h3><div class="note" id="Note3"><span class="noteLabel">Note: </span>The TEI lex 0 initiative recommends that all definitions (<span class="gi">&lt;def&gt;</span>) are actually part of an encompassing <span class="gi">&lt;sense&gt;</span></div><div id="index.xml-egXML-d29e341" class="pre egXML_valid"><span class="element">&lt;xsl:apply-templates <span class="attribute">select</span>="<span class="attributevalue">descendant::def[not(ancestor::sense)]/ancestor::entry</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"/&gt;</span></div></div><div class="teidiv1" id="index.xml-body.1_div.4_div.3"><h3><span class="headingNumber">4.3. </span><span class="head">Identifying duplicate entries</span></h3><p>Looking for all the different forms in the dictionary and checking those for which there exist more than one entry.</p><p>XPath and XSLT mechanisms in use:</p><ul><li class="item">XPtah function: <code>distinct-values()</code></li><li class="item">Creating variables with <span class="gi">&lt;xsl:variable&gt;</span></li><li class="item">Iterator XSLT construct: <span class="gi">&lt;xsl:for-each&gt;</span></li><li class="item">Arithmetic operator: <code>count()</code> and <code>&gt;</code></li><li class="item">Loosing the context node within an iteration (hence the <code>theDictionary</code> variable</li></ul><div id="index.xml-egXML-d29e375" class="pre egXML_valid"><span class="element">&lt;xsl:variable <span class="attribute">name</span>="<span class="attributevalue">theDictionary</span>"
 <span class="attribute">select</span>="<span class="attributevalue">/</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"/&gt;</span>
<span class="element">&lt;xsl:for-each <span class="attribute">select</span>="<span class="attributevalue">distinct-values(descendant::entry/form/orth)</span>"&gt;</span>
 <span class="element">&lt;xsl:variable <span class="attribute">name</span>="<span class="attributevalue">theForm</span>" <span class="attribute">select</span>="<span class="attributevalue">.</span>"/&gt;</span>
 <span class="element">&lt;xsl:if <span class="attribute">test</span>="<span class="attributevalue">count($theDictionary/descendant::entry[form/orth = $theForm])&gt;1</span>"&gt;</span>
  <span class="element">&lt;xsl:value-of <span class="attribute">select</span>="<span class="attributevalue">$theForm</span>"/&gt;</span>
  <span class="element">&lt;xsl:text&gt;</span> - <span class="element">&lt;/xsl:text&gt;</span>
 <span class="element">&lt;/xsl:if&gt;</span>
<span class="element">&lt;/xsl:for-each&gt;</span></div></div><div class="teidiv1" id="index.xml-body.1_div.4_div.4"><h3><span class="headingNumber">4.4. </span><span class="head">Different words used in definitions</span></h3><p>XPath and XSLT mechanisms in use:</p><ul><li class="item">XPtath iterator: <code>for X in Y return Z</code> with local variables</li><li class="item">XPath <code>tokenise()</code></li><li class="item">Practical <span class="att">separator</span> attribute on <span class="gi">&lt;xsl:value-of&gt;</span></li></ul><div id="index.xml-egXML-d29e405" class="pre egXML_valid"><span class="element">&lt;xsl:variable <span class="attribute">name</span>="<span class="attributevalue">wordsInDef</span>"
 <span class="attribute">select</span>="<span class="attributevalue">distinct-values(for $i in descendant::def return tokenize($i,' '))</span>"
   xmlns:xsl="http://www.w3.org/1999/XSL/Transform"/&gt;</span>
<span class="element">&lt;xsl:value-of <span class="attribute">select</span>="<span class="attributevalue">$wordsInDef</span>"
 <span class="attribute">separator</span>="<span class="attributevalue">; </span>"/&gt;</span></div></div></div><div class="teidiv0" id="index.xml-body.1_div.5"><h2><span class="headingNumber">5. </span><span class="head">Complementary remarks</span></h2><ul><li class="item">Favour a highly modular XSLT programming style to ensure conciseness and ease of maintenance.</li><li class="item">Therefore, always prefer <span class="gi">&lt;xsl:apply templates&gt;</span> to <span class="gi">&lt;xsl:for-each&gt;</span> when applicable</li><li class="item">When a stylesheet is not working, the main issue is usually a wrongly declared namespace. Pay attention to this when implementing an XML2XML scenario</li><li class="item">Take a regular look at the XPath and XSLT quick references (<a class="link_ref" href="http://www.mulberrytech.com/quickref/"><span class="titlem">Quick Reference Cards</span> from Mulberry Technologies, Inc.</a>): be curious to discover new functions, at least to know they exist.</li></ul></div><!--TEI back--><div class="stdfooter autogenerated"><div class="footer"><!--standard links to project, institution etc--><a class="plain" href="/">Home</a> </div><address> Laurent Romary.
	    Date: 2018-12-02<br /><!--
	  Generated from index.xml using XSLT stylesheets version 7.45.0
	       based on http://www.tei-c.org/Stylesheets/
	       on 2018-12-02T14:16:14Z.
	       SAXON PE 9.8.0.12.
		 --></address></div></body></html>